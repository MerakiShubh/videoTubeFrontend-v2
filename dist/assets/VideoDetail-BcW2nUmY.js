import{w as E,r as m,x as R,y as B,j as e,a as b,C as I,D as $,E as T,P as z,_ as O,L as N,R as U,f as H,H as M,J as A,K as L,M as q,N as W,Q as J,T as K,U as Q}from"./index-QFptoyZp.js";import{a as G,u as X,b as Y,c as Z}from"./video.hook-D9MhAd0S.js";import{P as ee}from"./ProgressBar-Co1JsP3d.js";import{N as D}from"./NextVideoCard-3OSfgD8A.js";function se({playlistId:a,videoId:r,playlistName:l}){const{data:t}=E(r,a),[s,u]=m.useState(t||!1),{mutateAsync:n}=R(),{mutateAsync:d}=B(),x=async()=>{await n({videoId:r,playlistId:a})},h=async()=>{await d({videoId:r,playlistId:a})};return e.jsx("li",{className:"mb-2 last:mb-0",children:e.jsxs("label",{className:"group/label inline-flex cursor-pointer items-center gap-x-3",htmlFor:`${a}-checkbox`,children:[e.jsx("input",{type:"checkbox",className:"peer hidden",id:`${a}-checkbox`,defaultChecked:s,onChange:p=>{p.target.checked?(u(!0),x()):(u(!1),h())}}),e.jsx("span",{className:"inline-flex h-4 w-4 items-center justify-center rounded-[4px] border border-transparent bg-white text-white group-hover/label:border-blue-500 peer-checked:border-blue-700 peer-checked:text-blue-700",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:"3",stroke:"currentColor","aria-hidden":"true",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4.5 12.75l6 6 9-13.5"})})}),l]})},a)}function ae({videoId:a}){const r=b(n=>{var d;return(d=n.auth.user)==null?void 0:d._id}),{data:l,isFetched:t,isFetching:s,isRefetching:u}=I(r);return u&&!t?e.jsx(ee,{}):e.jsx("ul",{className:"mb-4",children:t&&(l==null?void 0:l.length)>0?l.map(n=>e.jsx(se,{playlistId:n==null?void 0:n._id,videoId:a,playlistName:n==null?void 0:n.name},n._id)):e.jsx("p",{children:"No playlists found"})})}function le({videoId:a}){b(i=>{var c;return(c=i.auth.user)==null?void 0:c._id});const r=b(i=>i.auth.authStatus),[l,t]=m.useState(!1),[s,u]=m.useState(!1),[n,d]=m.useState(!1),x=i=>{i.stopPropagation(),r?t(!l):d(!0)},{mutateAsync:h}=$(),{mutateAsync:p}=R(),g=async i=>{i.preventDefault();const c=i.target.name.value;c||O.error("Name is required");const j=await h({name:c});j&&(t(!1),p({videoId:a,playlistId:j._id}))},f=m.useRef(null);return m.useEffect(()=>{const i=c=>{f.current&&!f.current.contains(c.target)&&t(!1)};return l&&document.addEventListener("mousedown",i),()=>{document.removeEventListener("mousedown",i)}},[l]),n?e.jsx(T,{onClose:()=>d(!1),loginTo:"Save Video to Playlist"}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"relative block",ref:f,children:[e.jsxs("button",{onClick:i=>x(i),className:"flex items-center gap-x-2 rounded-lg bg-white px-4 py-1.5 text-black",children:[e.jsx("span",{className:"inline-block w-5",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor","aria-hidden":"true",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 10.5v6m3-3H9m4.06-7.19l-2.12-2.12a1.5 1.5 0 00-1.061-.44H4.5A2.25 2.25 0 002.25 6v12a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18V9a2.25 2.25 0 00-2.25-2.25h-5.379a1.5 1.5 0 01-1.06-.44z"})})}),"Save"]}),l&&e.jsxs("div",{className:"absolute right-0 top-full z-10  w-64 overflow-hidden rounded-lg bg-[#0e0e0e] p-4 shadow shadow-slate-50/30 ",children:[e.jsx("h3",{className:"mb-4 text-center text-lg font-semibold",children:"Save to playlist"}),e.jsx(ae,{videoId:a}),e.jsxs("form",{onSubmit:i=>g(i),className:"flex flex-col",children:[e.jsx("label",{htmlFor:"playlist-name",className:"mb-1 inline-block cursor-pointer",children:"Name"}),e.jsx("input",{type:"text",name:"name",id:"playlist-name",placeholder:"Enter playlist name",required:!0,className:"w-full rounded-lg border border-transparent bg-white px-3 py-2 text-black outline-none focus:border-blue-600"}),e.jsx("button",{type:"submit",className:"mx-auto mt-4 rounded-lg bg-blue-400 px-4 py-2 text-black",children:"Create new playlist"})]})]})]}),s&&e.jsx(z,{onClose:h})]})}function o(){return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"w-full gap-x-2 border pr-2 md:flex animate-pulse",children:[e.jsx("div",{className:"relative mb-2 w-full md:mb-0 md:w-5/12",children:e.jsx("div",{className:"w-full pt-[56%] bg-gray-300 rounded",children:e.jsx("span",{className:"absolute bottom-1 right-1 inline-block rounded bg-gray-400 px-1.5 text-sm h-4 w-12"})})}),e.jsxs("div",{className:"flex gap-x-2 px-2 pb-4 pt-1 md:w-7/12 md:px-0 md:py-0.5",children:[e.jsx("div",{className:"h-12 w-12 shrink-0 md:hidden bg-gray-300 rounded-full"}),e.jsxs("div",{className:"w-full pt-1 md:pt-0",children:[e.jsx("div",{className:"mb-1 h-4 w-3/4 bg-gray-300 rounded"}),e.jsx("div",{className:"mb-0.5 mt-2 h-4 w-1/2 bg-gray-300 rounded"}),e.jsx("div",{className:"flex mt-1 h-4 w-1/3 bg-gray-300 rounded"})]})]})]})})}function te({currentVideoId:a}){const{data:r,isFetched:l,isFetching:t}=G(a);return t?e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx(o,{}),e.jsx(o,{}),e.jsx(o,{}),e.jsx(o,{}),e.jsx(o,{})]}):e.jsx(e.Fragment,{children:l&&r.map(s=>e.jsx(N,{to:`/video/${s._id}`,children:e.jsx(D,{video:s})},s._id))})}function re({userId:a}){const{data:r,isFetching:l,isFetched:t}=X({userId:a});return l?e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx(o,{}),e.jsx(o,{}),e.jsx(o,{}),e.jsx(o,{}),e.jsx(o,{})]}):e.jsx(e.Fragment,{children:t&&(r==null?void 0:r.pages.map((s,u)=>e.jsx(U.Fragment,{children:t&&s.docs.map(n=>e.jsx(N,{to:`/video/${n._id}`,children:e.jsx(D,{video:n})},n._id))},u)))})}function ne({videoId:a,name:r,userId:l}){const[t,s]=m.useState("all");return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>s("all"),className:`
      ${t==="all"?"bg-blue-500 text-white":"bg-gray-500 text-gray-200"}
      hover:bg-blue-700 font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline`,children:"All"}),e.jsxs("button",{onClick:()=>s("user"),className:`
      ${t==="user"?"bg-blue-500 text-white":"bg-gray-500 text-gray-200"}
      hover:bg-blue-700 font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline`,children:["From ",r]})]}),t==="all"?e.jsx(te,{currentVideoId:a}):e.jsx(re,{userId:l})]})}const ie=()=>e.jsxs("div",{className:"flex flex-col lg:flex-row bg-black text-white",children:[e.jsxs("div",{className:"w-full lg:w-3/4 p-4",children:[e.jsx("div",{className:"aspect-video bg-gray-800 rounded-lg animate-pulse mb-4",children:e.jsx("div",{className:"h-full flex items-center justify-center",children:e.jsx("div",{className:"w-16 h-16 bg-blue-600 rounded-full flex items-center justify-center",children:e.jsx("div",{className:"w-0 h-0 border-t-8 border-t-transparent border-l-12 border-l-white border-b-8 border-b-transparent ml-1"})})})}),e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"w-24 h-3 bg-gray-700 rounded-full animate-pulse"}),e.jsx("div",{className:"flex space-x-2",children:[1,2,3,4].map(a=>e.jsx("div",{className:"w-8 h-8 bg-gray-700 rounded-full animate-pulse"},a))})]}),e.jsx("div",{className:"h-6 bg-gray-700 rounded-md animate-pulse mb-4"}),e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-10 h-10 bg-gray-700 rounded-full animate-pulse mr-3"}),e.jsxs("div",{children:[e.jsx("div",{className:"h-4 w-32 bg-gray-700 rounded-md animate-pulse mb-2"}),e.jsx("div",{className:"h-3 w-24 bg-gray-700 rounded-md animate-pulse"})]})]}),e.jsx("div",{className:"flex space-x-2",children:[1,2].map(a=>e.jsx("div",{className:"w-20 h-8 bg-gray-700 rounded-full animate-pulse"},a))})]}),e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsx("div",{className:"h-4 bg-gray-700 rounded-md animate-pulse"}),e.jsx("div",{className:"h-4 bg-gray-700 rounded-md animate-pulse"}),e.jsx("div",{className:"h-4 bg-gray-700 rounded-md animate-pulse w-3/4"})]})]}),e.jsx("div",{className:"w-full lg:w-1/4 p-4 space-y-4",children:[1,2,3,4,5,6].map(a=>e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("div",{className:"w-40 h-24 bg-gray-800 rounded-lg animate-pulse"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"h-4 bg-gray-700 rounded-md animate-pulse mb-2"}),e.jsx("div",{className:"h-3 bg-gray-700 rounded-md animate-pulse w-3/4 mb-1"}),e.jsx("div",{className:"h-3 bg-gray-700 rounded-md animate-pulse w-1/2"})]})]},a))})]});function me(){var g,f,i,c,j,y,v,k,V,S,P,C,F;const a=H(),{videoId:r}=M(),l=b(w=>w.auth.authStatus),t=m.useRef(!1),{data:s,isFetching:u,isRefetching:n,isSuccess:d}=Y(r,l),{mutateAsync:x}=Z(),h=b(w=>{var _;return(_=w.auth.user)==null?void 0:_._id}),p=((g=s==null?void 0:s.owner)==null?void 0:g._id)===h;return m.useEffect(()=>(a(A(!1)),s&&a(L(s)),l&&d&&!t.current&&(x(r),t.current=!0),()=>{a(A(!0)),a(L(null))}),[a,s,l,d,r,x]),u&&!n?e.jsx("section",{className:"w-full pb-[70px] sm:ml-[70px]  sm:pb-0",children:e.jsx("div",{className:"flex w-full flex-wrap gap-4 p-4 lg:flex-nowrap",children:e.jsx("div",{className:"col-span-12 w-full",children:e.jsx("div",{className:"relative mb-4 w-full pt-[56%]",children:e.jsx("div",{className:"absolute inset-0",children:e.jsx("div",{className:"h-full w-full ",children:e.jsx(ie,{})})})})})})}):e.jsx("section",{className:"w-full pb-[70px] sm:ml-[70px]  sm:pb-0",children:e.jsxs("div",{className:"flex w-full flex-wrap gap-4 p-4 lg:flex-nowrap",children:[e.jsxs("div",{className:"col-span-12 w-full",children:[e.jsx("div",{className:"relative mb-4 w-full pt-[56%]",children:e.jsx("div",{className:"absolute inset-0",children:e.jsx("div",{className:"h-full w-full ",children:s&&e.jsx(q,{src:(f=s==null?void 0:s.video)==null?void 0:f.url,thumbnail:(i=s==null?void 0:s.thumbnail)==null?void 0:i.url,title:s==null?void 0:s.title,duration:s==null?void 0:s.duration})})})}),e.jsxs("div",{className:"group mb-4 w-full rounded-lg border p-4 duration-200 hover:bg-white/5 focus:bg-white/5",tabIndex:"0",children:[e.jsxs("div",{className:"flex flex-wrap gap-y-2",children:[e.jsxs("div",{className:"w-full md:w-1/2 lg:w-full xl:w-1/2",children:[e.jsx("h1",{className:"text-lg font-bold",children:s&&s.title}),e.jsxs("p",{className:"flex text-sm text-gray-200",children:[s&&s.views,"Views ·"," ",s&&W(s.createdAt)]})]}),e.jsx("div",{className:"w-full md:w-1/2 lg:w-full xl:w-1/2",children:e.jsxs("div",{className:"flex items-center justify-between gap-x-4 md:justify-end lg:justify-between xl:justify-end",children:[e.jsx(J,{type:"videos",id:s==null?void 0:s._id,isLiked:s==null?void 0:s.isLiked,likesCount:s==null?void 0:s.likesCount,className:"px-4",iconSize:"w-8"}),e.jsx(le,{videoId:s==null?void 0:s._id})]})})]}),e.jsxs("div",{className:"mt-4 flex items-center justify-between",children:[e.jsx(N,{to:`/channel/${(c=s==null?void 0:s.owner)==null?void 0:c.username}/videos`,children:e.jsxs("div",{className:"flex items-center gap-x-4",children:[e.jsx("div",{className:"mt-2 h-12 w-12 shrink-0",children:e.jsx("img",{src:s&&((y=(j=s==null?void 0:s.owner)==null?void 0:j.avatar)==null?void 0:y.url),alt:s&&((v=s==null?void 0:s.owner)==null?void 0:v.username),className:"h-full w-full rounded-full object-cover"})}),e.jsxs("div",{className:"block",children:[e.jsx("p",{className:"text-gray-200",children:s&&((k=s==null?void 0:s.owner)==null?void 0:k.username)}),e.jsxs("p",{className:"text-sm text-gray-400",children:[s&&((V=s==null?void 0:s.owner)==null?void 0:V.subscribersCount)," Subscribers"]})]})]})}),!p&&e.jsx(K,{isSubscribed:(S=s==null?void 0:s.owner)==null?void 0:S.isSubscribed,channelId:(P=s==null?void 0:s.owner)==null?void 0:P._id})]}),e.jsx("hr",{className:"my-4 border-white"}),e.jsx("div",{className:"h-5 overflow-hidden group-focus:h-auto",children:e.jsx("p",{className:"text-sm",children:s&&s.description})})]}),s&&e.jsx(Q,{videoId:s&&(s==null?void 0:s._id)})]}),e.jsx("div",{className:"col-span-12 flex w-full shrink-0 flex-col gap-3 lg:w-[350px] xl:w-[400px]",children:e.jsx(ne,{name:(C=s==null?void 0:s.owner)==null?void 0:C.fullName,videoId:s==null?void 0:s._id,userId:(F=s==null?void 0:s.owner)==null?void 0:F._id})})]})})}export{me as default};
